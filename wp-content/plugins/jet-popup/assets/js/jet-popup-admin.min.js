!function(e){"use strict";var t={init:function(){t.importInit(),e("#jet-popup-library-page")[0]&&t.presetLibraryInit(),e("#jet-popup-settings-page")[0]&&t.settingPageInit()},importInit:function(){var t=e("#jet-popup-import-trigger"),i=e("#jet-popup-create-trigger");if(!e("#wpbody-content .page-title-action")[0])return!1;e("#wpbody-content").find(".page-title-action:last").after(t),e("#wpbody-content").find(".page-title-action:last").after(i);tippy([t[0]],{html:document.querySelector("#jet-popup-import-form"),arrow:!0,placement:"bottom",flipBehavior:"clockwise",trigger:"click",interactive:!0,hideOnClick:!0,theme:"jet-popup-light"}),tippy([i[0]],{html:document.querySelector("#jet-popup-create-form"),arrow:!0,placement:"bottom",flipBehavior:"clockwise",trigger:"click",interactive:!0,hideOnClick:!0,theme:"jet-popup-light"})},presetLibraryInit:function(){Vue.config.devtools=!0,Vue.component("preset-filters",{template:"#preset-filters-template",props:{categories:Array,activeCategories:Array},data:function(){return{filterByValue:"date"}},methods:{filterByCategory:function(t,i){e.$emit("filterBycategory",t,i)},filterBy:function(t){this.filterByValue=t,e.$emit("filterBy",t)}}}),Vue.component("preset-list",{template:"#preset-list-template",props:{presets:Array},methods:{changePage:function(e){console.log(changePage)}}}),Vue.component("preset-item",{template:"#preset-item-template",props:{presetId:Number,title:String,thumbUrl:String,category:Array,categoryNames:Array,install:Number,required:Array,excerpt:String,details:Array,permalink:String},data:function(){return{modalShow:!1,requiredPluginData:window.jetPopupData.requiredPluginData}},computed:{categoryName:function(){var e="None";return 0!==this.categoryNames.length&&(e="",this.categoryNames.forEach(function(t,i){e+=t}),e=this.categoryNames.join(", ")),e},requiredPlugins:function(){var e=[],t=this.requiredPluginData;return this.required.forEach(function(i,a){t.hasOwnProperty(i)&&e.push(t[i])}),e}},methods:{openModal:function(){this.modalShow=!0},createPopup:function(){e.$emit("createPopup",this.presetId)}}}),Vue.component("presetlibrary",{template:"#preset-library-template",data:function(){return{spinnerShow:!0,presetsLoaded:!1,presetsLoadedError:!1,categoriesLoaded:!1,presetsData:[],categoryData:[],activeCategories:[],presetsLength:!1,page:1,perPage:8,preset:!1}},computed:{presetList:function(){var e=this.activeCategories,t=this.page,i=this.perPage,a=[];return a=this.presetsData.filter(function(t,i){var a=!1;for(var r in e)if(-1!==t.category.indexOf(e[r])){a=!0;break}return 0===e.length&&(a=!0),a}),this.presetsLength=a.length,a=a.filter(function(e,a){var r=!1,s=(t-1)*i;return a>=s&&a<s+i&&(r=!0),r})},isShowPagination:function(){return this.presetsLength>this.perPage}},methods:{filterByCategory:function(e,t){if(this.page=1,e)-1==this.activeCategories.indexOf(t)&&this.activeCategories.push(t);else{var i=this.activeCategories.indexOf(t);this.activeCategories.splice(i,1)}},filterBy:function(e){switch(this.page=1,e){case"date":this.presetsData.sort(function(e,t){return e.order-t.order});break;case"name":this.presetsData.sort(function(e,t){var i=e.title.toLowerCase(),a=t.title.toLowerCase();return i>a?1:i<a?-1:0});break;case"popular":this.presetsData.sort(function(e,t){return t.install-e.install})}},changePage:function(e){this.page=e}},created:function(){var t=window.jetPopupData.libraryPresetsUrl,i=window.jetPopupData.libraryPresetsCategoryUrl,a=[],r=[],s=this;axios.get(t).then(function(e){var t=e.data;if(t.success){for(var i in t.presets){var a=t.presets[i];r.push({id:a.id,title:a.title,thumb:a.thumb,category:a.category,categoryNames:a.category_names,order:a.order,install:+a.install,required:a.required,excerpt:a.excerpt,details:a.details,permalink:a.permalink})}s.presetsData=r,s.spinnerShow=!1,s.presetsLoaded=!0}else s.spinnerShow=!1,s.presetsLoadedError=!0}).catch(function(e){s.spinnerShow=!1,s.presetsLoadedError=!0,s.presetsData=[]}),axios.get(i).then(function(e){var t=e.data;if(t.success){for(var i in t.categories)a.push({id:i,label:t.categories[i],state:!1});s.categoryData=a}s.categoriesLoaded=!0}).catch(function(e){s.categoryData=[]}),e.$on("createPopup",function(e){s.preset=e,setTimeout(function(){s.$refs.jetPopupLibraryForm.submit()},100)}),e.$on("filterBycategory",function(e,t){s.filterByCategory(e,t)}),e.$on("filterBy",function(e){s.filterBy(e)})}});var e=new Vue;new Vue({el:"#jet-popup-library-page"})},settingPageInit:function(){Vue.config.devtools=!0,Vue.component("mailchimp-list-item",{template:"#mailchimp-list-item-template",props:{list:Object,apikey:String},data:function(){return{mergeFieldsStatusLoading:!1}},computed:{isMergeFields:function(){return!(!this.list.hasOwnProperty("mergeFields")||jQuery.isEmptyObject(this.list.mergeFields))}},methods:{getMergeFields:function(){var t=this;jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"get_mailchimp_list_merge_fields",apikey:this.apikey,listid:this.list.id},beforeSend:function(e,i){t.mergeFieldsStatusLoading=!0},error:function(e,t,i){},success:function(i,a,r){switch(t.mergeFieldsStatusLoading=!1,i.type){case"success":t.$Notice.success({title:i.title,desc:i.desc}),e.$emit("updateListMergeFields",i.request);break;case"error":t.$Notice.error({title:i.title,desc:i.desc})}}})}}}),Vue.component("settingsform",{template:"#settings-form-template",data:function(){return{modalSave:!1,saveStatusLoading:!1,syncStatusLoading:!1,mergeFieldsStatusLoading:!1,collapse:"mailChimpPanel",settingsData:{apikey:""},mailchimpAccountData:{},mailchimpListsData:{}}},computed:{isMailchimpAccountData:function(){return!jQuery.isEmptyObject(this.mailchimpAccountData)},isMailchimpListsData:function(){return!jQuery.isEmptyObject(this.mailchimpListsData)}},created:function(){var t=this,i=window.jetPopupAdminData.settings,a=window.jetPopupAdminData.mailchimpApiData;if(this.settingsData=i,a.hasOwnProperty(i.apikey)){var r=a[i.apikey];if(r.hasOwnProperty("account")){var s=r.account;this.mailchimpAccountData={account_id:s.account_id,username:s.username||"-",first_name:s.first_name||"-",last_name:s.last_name||"-",avatar_url:s.avatar_url}}if(r.hasOwnProperty("lists")){var n=r.lists,o={};if(!jQuery.isEmptyObject(n))for(var c in n){var u=n[c].info,p=n[c].merge_fields||[],l={};p.forEach(function(e,t,i){l[e.tag]=e.name}),o[c]={id:u.id,name:u.name,memberCount:u.stats.member_count,doubleOptin:u.double_optin,dateCreated:u.date_created,mergeFields:l}}this.mailchimpListsData=o}}e.$on("updateListMergeFields",function(e){var i=e.list_id,a=e.merge_fields,r={};for(c in a){var s=a[c];r[s.tag]=s.name}Vue.set(t.mailchimpListsData[i],"mergeFields",r)})},methods:{mailchimpSync:function(){var e=this;jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"get_mailchimp_user_data",apikey:this.settingsData.apikey},beforeSend:function(t,i){e.syncStatusLoading=!0},error:function(e,t){},success:function(t,i,a){switch(t.type){case"success":var r=t.request;e.$Notice.success({title:t.title,desc:t.desc}),e.mailchimpAccountData={account_id:r.account_id,username:r.username||"-",first_name:r.first_name||"-",last_name:r.last_name||"-",avatar_url:r.avatar_url},e.mailchimpSyncLists();break;case"error":e.syncStatusLoading=!1,e.$Notice.error({title:t.title,desc:t.desc})}}})},mailchimpSyncLists:function(){var e=this;jQuery.ajax({type:"POST",url:ajaxurl,data:{action:"get_mailchimp_lists",apikey:this.settingsData.apikey},beforeSend:function(t,i){e.syncStatusLoading=!0},error:function(e,t){},success:function(t,i,a){switch(e.syncStatusLoading=!1,t.type){case"success":e.$Notice.success({title:t.title,desc:t.desc});var r=t.request;if(r.hasOwnProperty("lists")){var s=r.lists,n={};for(var o in s){var c=s[o];n[c.id]={id:c.id,name:c.name,memberCount:c.stats.member_count,doubleOptin:c.double_optin,dateCreated:c.date_created}}e.mailchimpListsData=n}break;case"error":e.$Notice.error({title:t.title,desc:t.desc})}}})},saveSettings:function(){var e=this,t={action:"jet_popup_save_settings",data:this.settingsData};jQuery.ajax({type:"POST",url:ajaxurl,data:t,beforeSend:function(t,i){e.saveStatusLoading=!0},error:function(e,t,i){},success:function(t,i,a){switch(e.saveStatusLoading=!1,t.type){case"success":e.$Notice.success({title:t.title,desc:t.desc});break;case"error":e.$Notice.error({title:t.title,desc:t.desc})}}})},openSaveModal:function(){this.modalSave=!0}}});var e=new Vue;new Vue({el:"#jet-popup-settings-page"})}};t.init()}(jQuery);